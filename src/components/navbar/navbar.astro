---
import SearchBar from "@components/SearchBar";

const user = Astro.locals?.user ?? null;
const isAdmin = user?.role === "admin";
const isDistributor = user?.role === "distributor";
const logoutAction = "/api/auth/logout";
---

<header class="w-full bg-[#0046BE] text-white">
  <div
    class="mx-auto flex items-center justify-between gap-4 px-4 py-3 md:px-8">
    <!-- Left: logo + search -->
    <div class="flex items-center gap-3 min-w-0 flex-1">
      <a href="/" class="text-lg whitespace-nowrap">
        <span class="font-bold">UETA</span>
      </a>

      <div class="ml-2 flex-none">
        <SearchBar
          client:load
          isAdmin={isAdmin}
          isDistributor={isDistributor}
        />
      </div>
    </div>

    <!-- Right: auth (always visible, all screen sizes) -->
    <div class="flex items-center gap-2 shrink-0">
      {
        user ? (
          <>
            {user.img && (
              <img
                src={user.img}
                alt="avatar"
                class="hidden sm:block w-8 h-8 md:w-9 md:h-9 border border-white bg-red-700 rounded-full"
              />
            )}
            <span class="hidden sm:inline rounded-md bg-red-600 px-4 py-1.5 font-semibold text-white ">
              Welcome {user.name}
            </span>
            <form method="post" action={logoutAction}>
              <button
                type="submit"
                class="px-2 py-1 md:px-4 md:py-2 rounded text-sm md:text-base">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width={1.5}
                  stroke="currentColor"
                  class="h-7 w-7 cursor-pointer">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"
                  />
                </svg>
              </button>
            </form>
          </>
        ) : (
          <>
            <a
              href="/login"
              class="px-3 py-1 md:px-4 md:py-2 rounded text-sm md:text-base">
              {/* <div class="px-3 py-1 md:px-4 md:py-2 bg-white text-[#0046BE] rounded text-sm md:text-base">
                Login
              </div> */}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width={1.5}
                stroke="currentColor"
                class="h-8 w-8">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H2.25"
                />
              </svg>
            </a>
          </>
        )
      }
    </div>
  </div>
</header>
